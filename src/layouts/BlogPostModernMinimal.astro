---
/**
 * VARIATION 2: "Modern Minimal"
 * =============================
 * Ultra-clean, contemporary design featuring:
 * - Full-width hero image bleeding to edges
 * - Extremely clean layout with generous whitespace
 * - Sans-serif focused typography
 * - Floating table of contents on desktop (sticky sidebar)
 * - Progress bar at top showing read progress
 * - Tags as subtle pills at bottom
 * - Smooth animations and micro-interactions
 */
import type { CollectionEntry } from "astro:content";
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import FormattedDate from "../components/FormattedDate.astro";
import GoogleTag from "../components/GoogleTag.astro";

type Props = CollectionEntry<"blog">["data"];

const { title, description, pubDate, heroImage, tags, updatedDate }: Props = Astro.props;

const readingTime = 5;
---

<html lang="en">
  <head>
    <BaseHead title={title} description={description} />
    <GoogleTag />
    <!-- Google Fonts for Modern Feel -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&display=swap" rel="stylesheet">
    
    <style>
      /* ===== MODERN MINIMAL THEME ===== */
      
      :root {
        --font-sans: 'Inter', 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
        --minimal-accent: #b85c38;
        --minimal-accent-light: rgba(184, 92, 56, 0.1);
        --minimal-dark: #1a1a1a;
        --minimal-gray: #737373;
        --minimal-light-gray: #a3a3a3;
        --minimal-bg: #ffffff;
        --minimal-surface: #fafafa;
        --minimal-border: #e5e5e5;
      }

      .dark {
        --minimal-dark: #fafafa;
        --minimal-gray: #a3a3a3;
        --minimal-light-gray: #737373;
        --minimal-bg: #0a0a0a;
        --minimal-surface: #171717;
        --minimal-border: #262626;
        --minimal-accent-light: rgba(212, 165, 116, 0.15);
      }

      /* Progress Bar */
      .progress-bar {
        position: fixed;
        top: 0;
        left: 0;
        width: 0%;
        height: 3px;
        background: linear-gradient(90deg, var(--minimal-accent), #d4a574);
        z-index: 1000;
        transition: width 0.1s ease-out;
      }

      /* Main Container */
      .minimal-main {
        width: 100%;
        background: var(--minimal-bg);
        min-height: 100vh;
        font-family: var(--font-sans);
      }

      /* Hero Section - Full Width Bleed */
      .minimal-hero {
        position: relative;
        width: 100vw;
        height: 70vh;
        min-height: 400px;
        max-height: 600px;
        margin-left: calc(-50vw + 50%);
        overflow: hidden;
      }

      .minimal-hero-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        filter: brightness(0.9);
        transition: transform 0.5s ease;
      }

      .minimal-hero-overlay {
        position: absolute;
        inset: 0;
        background: linear-gradient(
          to bottom,
          transparent 0%,
          transparent 50%,
          var(--minimal-bg) 100%
        );
      }

      .dark .minimal-hero-overlay {
        background: linear-gradient(
          to bottom,
          transparent 0%,
          transparent 50%,
          var(--minimal-bg) 100%
        );
      }

      /* Article Layout */
      .minimal-article-wrapper {
        display: grid;
        grid-template-columns: 1fr min(720px, 100%) 1fr;
        gap: 0 3rem;
        padding: 0 1.5rem;
      }

      .minimal-article-wrapper > * {
        grid-column: 2;
      }

      /* Back Link */
      .minimal-back {
        padding: 2rem 0;
      }

      .minimal-back a {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--minimal-gray);
        text-decoration: none;
        transition: all 0.2s ease;
      }

      .minimal-back a:hover {
        color: var(--minimal-accent);
        gap: 0.75rem;
      }

      .minimal-back svg {
        transition: transform 0.2s ease;
      }

      .minimal-back a:hover svg {
        transform: translateX(-3px);
      }

      /* Header */
      .minimal-header {
        padding: 2rem 0 3rem;
      }

      /* Meta Row */
      .minimal-meta-row {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1.5rem;
        font-size: 0.875rem;
        color: var(--minimal-gray);
      }

      .minimal-meta-dot {
        width: 4px;
        height: 4px;
        border-radius: 50%;
        background: var(--minimal-light-gray);
      }

      /* Title */
      .minimal-title {
        font-size: clamp(2rem, 5vw, 3.5rem);
        font-weight: 700;
        line-height: 1.1;
        letter-spacing: -0.03em;
        color: var(--minimal-dark);
        margin: 0 0 1.5rem;
      }

      /* Description */
      .minimal-description {
        font-size: 1.25rem;
        font-weight: 400;
        line-height: 1.6;
        color: var(--minimal-gray);
        margin: 0;
      }

      /* Content Container with TOC */
      .minimal-content-wrapper {
        display: grid;
        grid-template-columns: 1fr;
        gap: 3rem;
        position: relative;
      }

      @media (min-width: 1200px) {
        .minimal-content-wrapper {
          grid-template-columns: 200px 1fr;
          gap: 4rem;
        }
      }

      /* Table of Contents */
      .minimal-toc {
        display: none;
      }

      @media (min-width: 1200px) {
        .minimal-toc {
          display: block;
          position: sticky;
          top: 100px;
          align-self: start;
          max-height: calc(100vh - 150px);
          overflow-y: auto;
        }
      }

      .minimal-toc-title {
        font-size: 0.75rem;
        font-weight: 600;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: var(--minimal-light-gray);
        margin-bottom: 1rem;
      }

      .minimal-toc-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .minimal-toc-item {
        margin: 0;
        padding: 0;
      }

      .minimal-toc-link {
        display: block;
        padding: 0.5rem 0;
        font-size: 0.875rem;
        color: var(--minimal-gray);
        text-decoration: none;
        border-left: 2px solid transparent;
        padding-left: 1rem;
        margin-left: -1rem;
        transition: all 0.2s ease;
      }

      .minimal-toc-link:hover,
      .minimal-toc-link.active {
        color: var(--minimal-accent);
        border-left-color: var(--minimal-accent);
      }

      .minimal-toc-link.active {
        font-weight: 500;
      }

      /* Content */
      .minimal-content {
        font-size: 1.125rem;
        line-height: 1.8;
        color: var(--minimal-dark);
      }

      .minimal-content :global(h2) {
        font-size: 1.75rem;
        font-weight: 600;
        letter-spacing: -0.02em;
        color: var(--minimal-dark);
        margin: 3rem 0 1.5rem;
        scroll-margin-top: 100px;
      }

      .minimal-content :global(h3) {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--minimal-dark);
        margin: 2.5rem 0 1rem;
        scroll-margin-top: 100px;
      }

      .minimal-content :global(p) {
        margin: 0 0 1.5rem;
        color: var(--minimal-gray);
      }

      .minimal-content :global(a) {
        color: var(--minimal-accent);
        text-decoration: none;
        border-bottom: 1px solid transparent;
        transition: border-color 0.2s ease;
      }

      .minimal-content :global(a:hover) {
        border-bottom-color: var(--minimal-accent);
      }

      .minimal-content :global(blockquote) {
        margin: 2.5rem 0;
        padding: 1.5rem 2rem;
        background: var(--minimal-surface);
        border-left: 3px solid var(--minimal-accent);
        border-radius: 0 8px 8px 0;
        font-style: normal;
      }

      .minimal-content :global(blockquote p) {
        margin: 0;
        font-size: 1.1rem;
        color: var(--minimal-dark);
      }

      .minimal-content :global(pre) {
        background: var(--minimal-surface);
        border: 1px solid var(--minimal-border);
        border-radius: 12px;
        padding: 1.5rem;
        margin: 2rem 0;
        overflow-x: auto;
      }

      .minimal-content :global(code) {
        font-family: 'SF Mono', 'Fira Code', monospace;
        font-size: 0.9em;
      }

      .minimal-content :global(p code),
      .minimal-content :global(li code) {
        background: var(--minimal-accent-light);
        color: var(--minimal-accent);
        padding: 0.2rem 0.5rem;
        border-radius: 6px;
        font-size: 0.875em;
      }

      .minimal-content :global(ul),
      .minimal-content :global(ol) {
        margin: 1.5rem 0;
        padding-left: 1.5rem;
      }

      .minimal-content :global(li) {
        margin: 0.75rem 0;
        color: var(--minimal-gray);
      }

      .minimal-content :global(img) {
        max-width: 100%;
        height: auto;
        border-radius: 12px;
        margin: 2rem 0;
      }

      .minimal-content :global(hr) {
        border: none;
        height: 1px;
        background: var(--minimal-border);
        margin: 3rem 0;
      }

      /* Footer Tags */
      .minimal-footer {
        padding: 3rem 0 4rem;
        border-top: 1px solid var(--minimal-border);
        margin-top: 3rem;
      }

      .minimal-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      .minimal-tag {
        display: inline-flex;
        align-items: center;
        padding: 0.5rem 1rem;
        background: var(--minimal-surface);
        border: 1px solid var(--minimal-border);
        border-radius: 100px;
        font-size: 0.8rem;
        font-weight: 500;
        color: var(--minimal-gray);
        text-decoration: none;
        transition: all 0.2s ease;
      }

      .minimal-tag:hover {
        background: var(--minimal-accent-light);
        border-color: var(--minimal-accent);
        color: var(--minimal-accent);
      }

      /* Updated Date */
      .minimal-updated {
        margin-top: 1.5rem;
        font-size: 0.875rem;
        color: var(--minimal-light-gray);
      }

      /* Share Section */
      .minimal-share {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-top: 2rem;
        padding-top: 2rem;
        border-top: 1px solid var(--minimal-border);
      }

      .minimal-share-label {
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--minimal-light-gray);
      }

      .minimal-share-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
        background: var(--minimal-surface);
        border: 1px solid var(--minimal-border);
        border-radius: 50%;
        color: var(--minimal-gray);
        text-decoration: none;
        transition: all 0.2s ease;
      }

      .minimal-share-btn:hover {
        background: var(--minimal-accent);
        border-color: var(--minimal-accent);
        color: white;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .minimal-hero {
          height: 50vh;
          min-height: 300px;
        }

        .minimal-title {
          font-size: 1.75rem;
        }

        .minimal-description {
          font-size: 1.1rem;
        }

        .minimal-content {
          font-size: 1rem;
        }
      }
    </style>
  </head>
  
  <body>
    <!-- Progress Bar -->
    <div class="progress-bar" id="progress-bar"></div>
    
    <Header />
    <main class="minimal-main dark:bg-[#0a0a0a] transition-colors duration-300">
      <article>
        <!-- Hero Image - Full Bleed -->
        {heroImage && (
          <div class="minimal-hero">
            <img 
              src={heroImage} 
              alt={title}
              class="minimal-hero-image"
            />
            <div class="minimal-hero-overlay"></div>
          </div>
        )}

        <div class="minimal-article-wrapper">
          <!-- Back Link -->
          <div class="minimal-back">
            <a href="/blog">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
              </svg>
              Back to articles
            </a>
          </div>

          <!-- Header -->
          <header class="minimal-header">
            <div class="minimal-meta-row">
              <span><FormattedDate date={pubDate} /></span>
              <span class="minimal-meta-dot"></span>
              <span>{readingTime} min read</span>
            </div>
            
            <h1 class="minimal-title">{title}</h1>
            
            {description && (
              <p class="minimal-description">{description}</p>
            )}
          </header>

          <!-- Content with TOC -->
          <div class="minimal-content-wrapper">
            <!-- Table of Contents (Desktop) -->
            <aside class="minimal-toc" id="toc">
              <h3 class="minimal-toc-title">On this page</h3>
              <ul class="minimal-toc-list" id="toc-list">
                <!-- Populated by JS -->
              </ul>
            </aside>

            <!-- Main Content -->
            <div class="minimal-content" id="article-content">
              <slot />
            </div>
          </div>

          <!-- Footer -->
          <footer class="minimal-footer">
            {tags && tags.length > 0 && (
              <div class="minimal-tags">
                {tags.map((tag: string) => (
                  <a href={`/blog/tag/${tag}`} class="minimal-tag">{tag}</a>
                ))}
              </div>
            )}

            {updatedDate && (
              <p class="minimal-updated">
                Last updated <FormattedDate date={updatedDate} />
              </p>
            )}

            <!-- Share Buttons -->
            <div class="minimal-share">
              <span class="minimal-share-label">Share</span>
              <a href="#" class="minimal-share-btn" id="share-twitter" aria-label="Share on Twitter">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                </svg>
              </a>
              <a href="#" class="minimal-share-btn" id="share-linkedin" aria-label="Share on LinkedIn">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                </svg>
              </a>
              <button class="minimal-share-btn" id="share-copy" aria-label="Copy link">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                  <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                </svg>
              </button>
            </div>
          </footer>
        </div>
      </article>
    </main>
    <Footer />

    <script>
      // Progress Bar
      (function() {
        const progressBar = document.getElementById('progress-bar');
        if (!progressBar) return;

        function updateProgress() {
          const scrollTop = window.scrollY;
          const docHeight = document.documentElement.scrollHeight - window.innerHeight;
          const progress = (scrollTop / docHeight) * 100;
          progressBar.style.width = `${Math.min(progress, 100)}%`;
        }

        window.addEventListener('scroll', updateProgress, { passive: true });
        updateProgress();
      })();

      // Table of Contents Generator
      (function() {
        const content = document.getElementById('article-content');
        const tocList = document.getElementById('toc-list');
        if (!content || !tocList) return;

        const headings = content.querySelectorAll('h2, h3');
        
        headings.forEach((heading, index) => {
          // Add ID if not present
          if (!heading.id) {
            heading.id = `heading-${index}`;
          }

          const li = document.createElement('li');
          li.className = 'minimal-toc-item';
          
          const a = document.createElement('a');
          a.href = `#${heading.id}`;
          a.className = 'minimal-toc-link';
          a.textContent = heading.textContent;
          
          if (heading.tagName === 'H3') {
            a.style.paddingLeft = '2rem';
            a.style.fontSize = '0.8rem';
          }
          
          li.appendChild(a);
          tocList.appendChild(li);
        });

        // Highlight active section
        const observerOptions = {
          rootMargin: '-100px 0px -66%',
          threshold: 0
        };

        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            const link = tocList.querySelector(`a[href="#${entry.target.id}"]`);
            if (link) {
              if (entry.isIntersecting) {
                tocList.querySelectorAll('.minimal-toc-link').forEach(l => l.classList.remove('active'));
                link.classList.add('active');
              }
            }
          });
        }, observerOptions);

        headings.forEach(heading => observer.observe(heading));
      })();

      // Share Buttons
      (function() {
        const url = encodeURIComponent(window.location.href);
        const title = encodeURIComponent(document.title);

        const twitterBtn = document.getElementById('share-twitter');
        const linkedinBtn = document.getElementById('share-linkedin');
        const copyBtn = document.getElementById('share-copy');

        if (twitterBtn) {
          twitterBtn.href = `https://twitter.com/intent/tweet?url=${url}&text=${title}`;
          twitterBtn.target = '_blank';
        }

        if (linkedinBtn) {
          linkedinBtn.href = `https://www.linkedin.com/sharing/share-offsite/?url=${url}`;
          linkedinBtn.target = '_blank';
        }

        if (copyBtn) {
          copyBtn.addEventListener('click', async () => {
            try {
              await navigator.clipboard.writeText(window.location.href);
              copyBtn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 6L9 17l-5-5"/></svg>';
              setTimeout(() => {
                copyBtn.innerHTML = '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>';
              }, 2000);
            } catch (err) {
              console.error('Failed to copy:', err);
            }
          });
        }
      })();
    </script>
  </body>
</html>
